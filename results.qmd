# Results
```{r, include=FALSE}
# Load necessary libraries
library(tidyverse)
library(readr)
library(lubridate)
library(dplyr)
library(reshape2)

# Set path
data_path <- "data/clean/"

# Import cleaned data files
actigraph_df <- read_csv(file.path(data_path, "clean_actigraph.csv"))
demo_df      <- read_csv(file.path(data_path, "clean_demo.csv"))
liking_df    <- read_csv(file.path(data_path, "clean_liking.csv"))
q_df         <- read_csv(file.path(data_path, "clean_questionnaires.csv"))
avg_df       <- read_csv(file.path(data_path, "clean_recall.csv"))

# Check structure
glimpse(actigraph_df)
glimpse(demo_df)
glimpse(liking_df)

```

## Graph 1: Overall MVPA  (Moderate to Vigorous Physical Activity) Trend (Mean ± SE)
```{r}
# Aggregate average MVPA by date
mvpa_by_date <- actigraph_df |>
  dplyr::group_by(date) |>
  dplyr::summarise(
    mean_mvpa = mean(mvpa, na.rm = TRUE),
    sd_mvpa = sd(mvpa, na.rm = TRUE),
    n = n(),
    se_mvpa = sd_mvpa / sqrt(n)
  )

mvpa_by_date_clean <- mvpa_by_date |> 
  filter(!is.na(se_mvpa))

# Plot
ggplot(mvpa_by_date, aes(x = date, y = mean_mvpa)) +
  geom_line(color = "#0072B9", size = 1.2) +
  geom_ribbon(
    aes(ymin = pmax(mean_mvpa - se_mvpa, 0), ymax = mean_mvpa + se_mvpa),
    alpha = 0.2,
    fill = "red"
  ) +
  labs(
    title = "Average MVPA Over Time",
    x = "Date",
    y = "Mean MVPA (minutes)"
  ) +
  theme_minimal()




```

This graph shows how participants’ average daily moderate-to-vigorous physical activity (MVPA) changed over the full study period. While there’s a lot of day-to-day variation, we can see some general ups and downs that might reflect seasonal changes — like people being more active during warmer months and less so in the winter.

That said, this plot alone doesn’t offer conclusive evidence about the video game's impact on physical activity. However, it gives us a useful overall picture of how MVPA fluctuated throughout the study period. To better assess potential effects of gameplay, we’ll next look at changes in MVPA across defined timepoints — from baseline to later weeks.

## Graph 2: MVPA Distribution by Total Minutes and Time point
```{r}
ggplot(actigraph_df, aes(x = minutes, y = mvpa)) +
  geom_point(alpha = 0.35, color = "#1f77b4", size = 2) +
  labs(
    title = "Relationship Between Total Minutes and MVPA",
    x = "Total Minutes per Day",
    y = "MVPA Minutes per Day"
  ) +
  theme_minimal(base_size = 14)
```

From the data, we notice that there's a variable of total minutes a child wears the ActiGraph. At first glance, using MVPA/Total Minutes might me more suitable than using MVPA it self as the proportion of children taking MVPA of the child's total minutes tracked. Hence, to proceed with further analysis, we first ask the question that whether MVPA would be correlated with total minutes. Here we can tell that most children wear the ActiGraph whole day, which corresponds to 1440 minutes. Some children wear it around 750 minutes per day, which corresponds to around 12 hours, this is potentially due to children not wearing it during sleep time. The randomness of the MVPA for all total minutes per day, except for the left most few cases where the total minutes are too low, aligns with the hypothesis as sleeping time doesn't affec MVPA since children need to be awake to perform vigorous and moderate physical activities. Therefore, we can use MVPA directly moving forward in this study.


## Graph 3: MVPA Distribution by Timepoint (week)
```{r}
actigraph_df <- actigraph_df |>
  mutate(timepoint = factor(timepoint, levels = c("baseline", "week1", "week3", "week6", "week10")))

# Create boxplot
ggplot(actigraph_df, aes(x = timepoint, y = mvpa)) +
  geom_boxplot(fill = "#69b3a2", alpha = 0.8, outlier.shape = 16, outlier.size = 1.5) +
  labs(
    title = "MVPA Distribution by Timepoint",
    x = "Timepoint",
    y = "MVPA (minutes/day)"
  ) +
  theme_minimal(base_size = 14)
```

This boxplot illustrates the distribution of daily MVPA across all five timepoints: baseline, week1, week3, week6, and week10. The median MVPA remains relatively consistent over time, with only slight fluctuations, suggesting no major shifts in overall group activity. The interquartile range is stable, and the presence of outliers at each timepoint indicates that while some individuals had very high activity levels, most participants clustered within a similar range. While we can’t conclude strong effects from this plot alone, the consistency across timepoints suggests that, at the group level, MVPA did not markedly increase or decrease throughout the study.

## Graph 4:  Stacked Activity Composition (Sedentary → Vigorous)
```{r}

# Summarize average activity per timepoint
composition_df <- actigraph_df |>
  dplyr::group_by(timepoint) |>
  dplyr::summarise(
    sedentary = mean(sedentary, na.rm = TRUE),
    light = mean(light, na.rm = TRUE),
    moderate = mean(moderate, na.rm = TRUE),
    vigorous = mean(vigorous, na.rm = TRUE)
  )

# Ensure timepoint is an ordered factor
composition_df <- composition_df |>
  mutate(timepoint = factor(timepoint, levels = c("baseline", "week1", "week3", "week6", "week10")))

# Pivot to long format
composition_long <- composition_df |>
  pivot_longer(cols = c(sedentary, light, moderate, vigorous),
               names_to = "activity_type",
               values_to = "minutes")

ggplot(composition_long, aes(x = timepoint, y = minutes, fill = activity_type, group = activity_type)) +
  geom_area(position = "stack", alpha = 0.8) +
  labs(
    title = "Stacked Activity Composition Over Time",
    x = "Timepoint",
    y = "Minutes per Day"
  ) +
  scale_fill_brewer(palette = "Set2") +
  theme_minimal()


```

From this graph, we observe a slight increase in participants’ sedentary behavior over time, while moderate, light, and vigorous activity levels remained relatively stable. From the graph, we find that active games has minimal effect on improving participants' activity time. Participants' sedentary time increased as they play active games.

## Graph 5: Individual MVPA Trajectories (Spaghetti Plot)

```{r}
ggplot(actigraph_df, aes(x = timepoint, y = mvpa, group = participant_id)) +
  geom_line(alpha = 0.2, color = "#0072B2") +
  stat_summary(aes(group = 1), fun = mean, geom = "line", color = "red", size = 1.2) +
  labs(
    title = "Individual MVPA Trajectories Over Time",
    x = "Timepoint",
    y = "MVPA (minutes/day)"
  ) +
  theme_minimal()
```

In this graph, the mean MVPA (red line) shows only minimal fluctuation across timepoints, indicating that, on average, participants did not significantly increase their MVPA. While a few individuals exhibited spikes or drops in activity, most participants remained consistently below 50 minutes per day.

These results suggest that the intervention (e.g., active games or engagement strategy) had limited effect in shifting daily MVPA levels. The relatively flat group mean trend implies that participants maintained similar activity patterns throughout the study.


## Graph 6: Change in MVPA from the baseline (grouped by groups -- difference autonomy of choosing games)
```{r}

mvpa_change_df <- actigraph_df |>
  left_join(liking_df |> select(participant_id, group), by = "participant_id") |>
  mutate(
    timepoint = factor(timepoint, levels = c("baseline", "week1", "week3", "week6", "week10")),
    group = factor(group, levels = c(0, 1), 
                   labels = c("Rule-Followers (Low Autonomy)", "Choosers (High Autonomy)"))
  )

# Compute baseline MVPA
baseline_df <- mvpa_change_df |>
  filter(timepoint == "baseline") |>
  dplyr::group_by(participant_id) |>
  dplyr::summarise(baseline_mvpa = mean(mvpa, na.rm = TRUE), .groups = "drop")

# Calculate change from baseline
mvpa_change_df <- mvpa_change_df |>
  left_join(baseline_df, by = "participant_id") |>
  mutate(delta_mvpa = mvpa - baseline_mvpa)

# Plot
ggplot(mvpa_change_df, aes(x = timepoint, y = delta_mvpa)) +
  geom_jitter(aes(color = group), width = 0.2, alpha = 0.6, size = 1.5) +
  stat_summary(fun = mean, geom = "line", aes(group = group, color = group), linewidth = 1.2) +
  stat_summary(fun.data = mean_se, geom = "errorbar", aes(group = group, color = group), width = 0.2) +
  labs(
    title = "Change in MVPA From Baseline",
    x = "Timepoint",
    y = "Δ MVPA (minutes per day)",
    color = "Group"
  ) +
  theme_minimal()
```
The graph shows that across all follow-up timepoints (weeks 1, 3, 6, and 10), the average change in MVPA for both groups remained close to zero. Participants with high autonomy has slightly higher average change in MVPA compared to rule followers.However, the increase wasn't significant enough to conclude intervention lead to improvement in MVPA.

## Graph 7: Change MVPA V.S. Demographics

```{r}
actid_df <- actigraph_df |>
  mutate(week = timepoint) |>
  select(!timepoint) |>
  dplyr::group_by(participant_id) |>
  dplyr::summarise(
    mvpa = mean(mvpa)
  )

actid_df <- demo_df |> 
  left_join(actid_df,
            by = c("participant_id")) |>
  drop_na() |> 
  ungroup()

actid_df_long <- actid_df |>
  mutate(across(c(admitweight, admitheight, gender, race_desc, birth_year),
                as.character)) |>
  pivot_longer(
    cols = c(admitweight, admitheight, gender, race_desc, birth_year),
    names_to  = "demographic",
    values_to = "demo_value"
  )

ggplot(actid_df_long, aes(x = demo_value, y = mvpa)) +
  geom_point(alpha = 0.5) +
  facet_wrap(~ demographic, scales = "free_x") +
  labs(
    title = "MVPA by Demographic Factors",
    x = "Demographic value",
    y = "MVPA (minutes/day)"
  ) +
  theme_minimal(base_size = 14)

```

From the graph we can observe that male children do tend to have more times in moderate and vigorous physical activities comparing to female children. There are too few data for other races besides white and thus we can't conclude a significant finding. The data also looks random for other variables. Hence, we conclude that gender might be the only important demographics variable that affects MVPA

## Graph 8: Change in physical and sedentary activities V.S. Liking Ratings

```{r}
compid_df <- actigraph_df |>
  mutate(week = timepoint) |>
  select(!timepoint) |>
  dplyr::group_by(participant_id, week) |>
  dplyr::summarise(
    sedentary = mean(sedentary, na.rm = TRUE),
    light = mean(light, na.rm = TRUE),
    moderate = mean(moderate, na.rm = TRUE),
    vigorous = mean(vigorous, na.rm = TRUE)
  )


compid_df <- compid_df |>
  mutate(week = case_when(
      week == "baseline" ~ "bsl",
      week == "week1"    ~ "wk1",
      week == "week3"    ~ "wk3",
      week == "week6"    ~ "wk6",
      week == "week10"   ~ "wk10")) |>
  mutate(week = factor(week, levels = c("bsl", "wk1", "wk3", "wk6", "wk10"))) |>
  ungroup()

compliking <- liking_df |> 
  left_join(compid_df,
            by = c("participant_id", "week")) |>
  drop_na() |> 
  ungroup()

compliking_long <- compliking |>
  # combine all non-sedentary intensities into one "active" variable
  mutate(active = light + moderate + vigorous) |>
  select(participant_id, week, trad, sed, sedentary, active) |>
  
  # first pivot the two liking variables into one column
  pivot_longer(
    cols = c(trad, sed),
    names_to = "liking_type",
    values_to = "liking_score"
  ) |>
  
  # then pivot the two activity variables into one column
  pivot_longer(
    cols = c(sedentary, active),
    names_to = "activity_type",
    values_to = "minutes"
  ) |>
  
  # nice labels
  mutate(
    liking_type = recode(
      liking_type,
      trad = "Ratings of Physical Activities",
      sed  = "Ratings of Sedentary Activities"
    ),
    activity_type = recode(
      activity_type,
      sedentary = "Sedentary activities",
      active    = "Physical Activities"
    )
  )

ggplot(compliking_long,
       aes(x = liking_score, y = minutes, color = activity_type)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "loess", se = FALSE, linewidth = 1.2) +
  facet_wrap(~ liking_type, scales = "free_x") +
  labs(
    title = "Acitivities by Liking Ratings of Physical and Sedentary Activities",
    x = "Liking Rating",
    y = "Minutes per Day",
    color = "Activity type"
  ) +
  theme_minimal(base_size = 14)
```

In this graph, we focus on the liking data, which contains ratings of how children wanted to perform physical and sedentary activities on a scale of 1-10. We can observe from the graph that there exists a clear increasing trend for physical activities time as ratings of physical activities increases, meaning that children would do more physical activities if they like them more. We do observe that also the sedentary activities minutes decreases when the rating of physical activities changes from around 9 to 10, it's mainly at a constant time. This might indicate that except children who likes physical activities heavily, children tends to have similar sedentary activities time. However, the trend for the sedentary liking rating graph is not that clear. We do observe that the sedentary activities time increases as rating increases from 6 to 7 and from 8 to 9, but it decreases from 5 to 6, 7 to 8 and 9 to 10. The points with a rating lower than 5 seems to be outliers. We also observe that there are fewer data at rating 8, where the physical activities time also behaves out of pattern as it tends to be decreasing as the sedentary liking rating increases but increases sharply at rating 8, which might indicate that the results at rating 8 is not that significant. Besides these cases, we can say that children are mostly honest and can mostly reflect themselves precisely. This means that we can trust their answers for questionnaires currently and future studies can investigate further upon results from the questionnaires.

## Graph 9: Active Video Gaming Time by Timepoint

```{r}
avgw_df <- avg_df |>
  mutate(participant_id = volunteer_number,
         week = case_when(
      week == "Baseline" ~ "bsl",
      week == "1"    ~ "wk1",
      week == "3"    ~ "wk3",
      week == "6"    ~ "wk6",
      week == "10"   ~ "wk10")) |>
  mutate(week = factor(week, levels = c("bsl", "wk1", "wk3", "wk6", "wk10"))) |>
  select(!c(volunteer_number, x10_1_how_much_time_did_you_spend_in_sports_active_games)) |>
  ungroup()|>
  group_by(week, participant_id)|>
  dplyr::summarize(
    mean_time = mean(time)
  )

ggplot(avgw_df, aes(x = week, y = mean_time)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Active Video Gaming Time by Timepoint",
    x = "Timepoint",
    y = "Active Video Gaming Time (hours/day)"
  ) +
  theme_minimal(base_size = 14)+
  scale_y_continuous(limits = c(0, 10))
```

From the graph, we can observe a clear similar trend as the one in Graph 2: MVPA by Timepoint, this indicates an association between Active Video Gaming Time (reported through questionnaires) and Moderate to Vigorous Physical Activity time.

## Graph 10: MVPA by Active Video Games (AVG)

```{r}
actidw_df <- actigraph_df |>
  mutate(week = timepoint) |>
  select(!timepoint) |>
  dplyr::group_by(participant_id, week) |>
  dplyr::summarise(
    mvpa = mean(mvpa)
  )|>
  mutate(week = case_when(
      week == "baseline" ~ "bsl",
      week == "week1"    ~ "wk1",
      week == "week3"    ~ "wk3",
      week == "week6"    ~ "wk6",
      week == "week10"   ~ "wk10")) |>
  mutate(week = factor(week, levels = c("bsl", "wk1", "wk3", "wk6", "wk10"))) |>
  ungroup()

q_df_c <- q_df |>
  mutate(week = session) |>
  select(!session)

compq <- q_df_c |> 
  left_join(actidw_df,
            by = c("participant_id", "week")) |>
  drop_na() |> 
  ungroup()
```



