---
title: "clean"
format: html
---

## Data Cleaning
```{r}
library(readxl)
library(tidyverse)
library(lubridate)
library(janitor)
library(skimr)

actigraph_raw <- actigraph_raw <- read_excel("data/raw/actigraph_activity_data.xlsx",
                                             sheet = "WORKSET"
                                             )
demo_raw      <- read_excel("data/raw/Demographics_(Birthdate-Year).xlsx")
liking_raw    <- read_excel("data/raw/liking_data.xlsx")
```

```{r}
# Clean demographic data


clean_demo <- demo_raw |>
  janitor::clean_names() |>  # Standardize column names to snake_case
  mutate(
    # Extract numeric ID from 'vol' column by removing "406-"
    participant_id = as.numeric(gsub("406-", "", vol)),

    # Convert birthdate string to numeric birth year
    birth_year = as.numeric(birthdate)
  ) |>
  relocate(participant_id, .before = 1) |>  # Move participant_id to first column
  select(-withdrawal_date, -ethnic_desc, -birthdate, -vol) |>  # Drop unneeded columns
  arrange(participant_id)  # Optional: sort by participant ID

# View summary statistics to check structure and missingness
skimr::skim(clean_demo)

write_csv(clean_demo, "data/clean/clean_demo.csv")


```

```{r}
# Clean and filter ActiGraph data

clean_actigraph <- actigraph_raw |>
  janitor::clean_names() |>
  mutate(
    participant_id = str_remove(vol, "406-") |> as.numeric()
  ) |>
  select(-vol, -filename) |>
  relocate(participant_id) |>
  filter(if_all(everything(), ~ !is.na(.))) |>  # Remove rows with any missing values
  arrange(participant_id, date)

# Confirm missing data removed
skimr::skim(clean_actigraph)

write_csv(clean_actigraph, "data/clean/clean_actigraph.csv")

```

```{r}

# Clean and process the data
clean_liking <- liking_raw |>
  janitor::clean_names() |>  # Convert column names to snake_case
  mutate(
    participant_id = as.numeric(gsub("406-", "", volunteer))  # Normalize participant ID
  ) |>
  select(participant_id, week, group, trad, avg_t, sed, avg_s) |>  # Reorder and select relevant columns
  drop_na()  # Remove rows with any missing values
skimr::skim(clean_liking)

# Save the cleaned data
write_csv(clean_liking, "data/clean/clean_liking.csv")
```


